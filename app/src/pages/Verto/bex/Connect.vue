<template>
<div>
<div v-show="false">
<svg class="walletconnect-qrcode__image" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 53 53" shape-rendering="crispEdges"><path fill="#ffffff" d="M0 0h53v53H0z"></path><path stroke="#000000" d="M0 0.5h7m4 0h2m1 0h2m1 0h4m3 0h1m2 0h2m1 0h1m1 0h2m1 0h2m2 0h2m1 0h1m3 0h7M0 1.5h1m5 0h1m3 0h2m2 0h2m2 0h2m3 0h3m5 0h1m2 0h1m2 0h3m1 0h3m2 0h1m5 0h1M0 2.5h1m1 0h3m1 0h1m1 0h1m1 0h1m1 0h4m1 0h2m1 0h2m2 0h1m2 0h2m3 0h1m2 0h3m2 0h1m2 0h1m2 0h1m1 0h3m1 0h1M0 3.5h1m1 0h3m1 0h1m1 0h4m2 0h2m1 0h2m2 0h1m1 0h1m1 0h1m3 0h3m4 0h1m2 0h1m2 0h1m1 0h1m1 0h1m1 0h3m1 0h1M0 4.5h1m1 0h3m1 0h1m1 0h2m1 0h2m5 0h3m1 0h1m1 0h5m1 0h2m1 0h1m1 0h2m3 0h3m3 0h1m1 0h3m1 0h1M0 5.5h1m5 0h1m1 0h1m4 0h1m2 0h5m3 0h1m3 0h2m1 0h1m2 0h1m1 0h4m1 0h2m3 0h1m5 0h1M0 6.5h7m1 0h1m1 0h1m1 0h1m1 0h1m1 0h1m1 0h1m1 0h1m1 0h1m1 0h1m1 0h1m1 0h1m1 0h1m1 0h1m1 0h1m1 0h1m1 0h1m1 0h1m1 0h1m1 0h1m1 0h7M8 7.5h1m2 0h1m1 0h2m2 0h2m2 0h1m2 0h1m3 0h1m1 0h1m2 0h3m2 0h3m1 0h2M0 8.5h1m1 0h5m2 0h1m3 0h5m2 0h1m2 0h6m2 0h2m3 0h1m6 0h2m1 0h5M3 9.5h1m4 0h6m1 0h3m3 0h2m1 0h1m2 0h4m1 0h1m2 0h1m1 0h1m3 0h2m4 0h1m3 0h2M0 10.5h1m1 0h1m2 0h4m2 0h2m4 0h1m1 0h1m1 0h1m4 0h1m4 0h4m1 0h4m3 0h1m1 0h2m1 0h2M0 11.5h1m2 0h2m2 0h1m4 0h1m1 0h1m1 0h1m1 0h1m3 0h3m5 0h4m4 0h3m4 0h1m1 0h1m1 0h1m2 0h1M0 12.5h2m3 0h2m1 0h1m2 0h1m2 0h1m2 0h5m1 0h5m1 0h2m4 0h3m3 0h2m1 0h1m3 0h1m1 0h1M4 13.5h1m6 0h1m3 0h2m1 0h1m1 0h1m1 0h1m4 0h2m1 0h1m2 0h1m3 0h1m3 0h3m1 0h1m1 0h6M1 14.5h1m2 0h1m1 0h2m3 0h1m1 0h2m2 0h1m2 0h1m2 0h1m1 0h1m3 0h2m1 0h1m1 0h2m2 0h1m1 0h1m2 0h1m2 0h1m1 0h1m1 0h1M0 15.5h1m1 0h1m2 0h1m2 0h4m2 0h2m1 0h1m2 0h2m1 0h3m2 0h5m1 0h1m5 0h3m1 0h1m1 0h2m1 0h1m1 0h1M1 16.5h1m2 0h1m1 0h3m2 0h1m2 0h1m1 0h3m2 0h1m1 0h2m1 0h1m3 0h2m1 0h2m1 0h4m2 0h1m1 0h1m3 0h1m1 0h2M0 17.5h1m3 0h1m2 0h5m2 0h1m1 0h3m3 0h3m2 0h2m1 0h2m2 0h2m3 0h5m4 0h1m3 0h1M4 18.5h3m1 0h2m1 0h1m4 0h3m3 0h1m3 0h1m2 0h1m1 0h1m1 0h1m2 0h3m5 0h6m1 0h1M1 19.5h1m2 0h1m3 0h2m1 0h2m1 0h1m6 0h4m2 0h1m1 0h2m2 0h1m1 0h1m3 0h4m6 0h1M1 20.5h1m1 0h1m2 0h4m1 0h3m3 0h1m4 0h1m2 0h2m2 0h3m1 0h2m1 0h2m3 0h6m1 0h1m1 0h2M0 21.5h1m1 0h4m6 0h1m1 0h1m3 0h2m1 0h1m2 0h1m2 0h1m2 0h1m1 0h1m3 0h2m1 0h1m1 0h2m2 0h1m2 0h1m2 0h2M3 22.5h2m1 0h1m5 0h4m3 0h2m3 0h3m1 0h2m3 0h4m1 0h3m3 0h1m1 0h5M1 23.5h2m1 0h2m1 0h2m2 0h1m4 0h1m2 0h5m1 0h1m1 0h3m1 0h3m2 0h1m1 0h3m2 0h1m1 0h1m1 0h1m3 0h2M0 24.5h2m1 0h7m4 0h1m4 0h1m1 0h1m2 0h7m3 0h2m6 0h1m1 0h7m1 0h1M4 25.5h1m3 0h3m3 0h1m3 0h1m1 0h1m1 0h3m3 0h1m1 0h2m5 0h1m1 0h2m1 0h3m3 0h1m2 0h2M1 26.5h1m2 0h1m1 0h1m1 0h1m3 0h1m1 0h2m1 0h1m1 0h3m1 0h2m1 0h1m1 0h2m3 0h1m1 0h1m2 0h2m1 0h1m1 0h2m1 0h1m1 0h3M3 27.5h2m3 0h1m1 0h1m1 0h1m1 0h1m1 0h1m1 0h2m2 0h3m3 0h4m2 0h1m2 0h1m2 0h1m1 0h1m1 0h1m3 0h1m2 0h2M0 28.5h9m1 0h1m2 0h2m1 0h5m2 0h6m5 0h3m2 0h1m1 0h1m1 0h9M0 29.5h2m1 0h3m1 0h2m1 0h1m1 0h2m1 0h2m1 0h1m1 0h5m1 0h1m1 0h1m1 0h2m1 0h1m2 0h2m1 0h2m1 0h3m1 0h1m1 0h1m3 0h1M0 30.5h3m1 0h1m1 0h1m1 0h2m1 0h1m3 0h1m2 0h5m1 0h3m1 0h2m3 0h2m2 0h2m1 0h2m3 0h1m2 0h2M0 31.5h1m3 0h2m6 0h3m1 0h2m5 0h1m2 0h2m1 0h1m1 0h2m4 0h2m1 0h5m1 0h1m1 0h1M0 32.5h3m3 0h1m1 0h4m1 0h1m2 0h2m1 0h3m3 0h3m5 0h1m2 0h1m1 0h2m2 0h1m6 0h3M0 33.5h3m6 0h2m1 0h1m1 0h3m1 0h2m2 0h3m4 0h1m1 0h1m1 0h1m2 0h2m3 0h2m2 0h5m2 0h1M0 34.5h1m1 0h1m2 0h4m1 0h2m4 0h3m9 0h1m1 0h1m1 0h1m1 0h1m3 0h1m4 0h1m1 0h1m3 0h1m1 0h1M7 35.5h2m1 0h1m2 0h1m1 0h1m4 0h2m1 0h2m2 0h1m1 0h2m1 0h2m1 0h1m4 0h5m1 0h4m1 0h2M0 36.5h1m1 0h2m1 0h2m1 0h1m1 0h1m3 0h3m1 0h4m2 0h1m3 0h1m2 0h1m3 0h2m2 0h1m1 0h1m4 0h1m3 0h1M0 37.5h2m2 0h1m2 0h1m1 0h4m2 0h2m3 0h1m1 0h2m1 0h3m2 0h4m2 0h1m4 0h3m2 0h3m3 0h1M0 38.5h1m3 0h1m1 0h3m1 0h3m1 0h8m2 0h3m1 0h1m3 0h1m3 0h3m1 0h1m3 0h1m3 0h2m1 0h1M2 39.5h1m1 0h2m2 0h1m2 0h3m3 0h1m2 0h1m9 0h4m1 0h1m4 0h1m1 0h5m2 0h1m1 0h1M0 40.5h1m1 0h1m1 0h4m1 0h3m1 0h1m1 0h1m1 0h3m1 0h1m1 0h3m1 0h2m4 0h2m1 0h4m5 0h1m1 0h1m2 0h1M0 41.5h1m3 0h1m3 0h2m1 0h1m2 0h3m1 0h1m4 0h1m2 0h1m2 0h3m1 0h1m1 0h3m1 0h1m1 0h3m1 0h2m1 0h1m2 0h2M0 42.5h2m1 0h4m1 0h2m2 0h6m2 0h1m3 0h2m2 0h1m1 0h2m1 0h3m2 0h3m3 0h1m2 0h1m1 0h1M1 43.5h2m4 0h3m2 0h1m4 0h2m4 0h2m1 0h2m2 0h1m1 0h2m2 0h2m1 0h2m2 0h1m2 0h1m1 0h1m3 0h1M3 44.5h1m2 0h1m1 0h3m1 0h2m2 0h2m2 0h2m2 0h5m2 0h1m4 0h1m5 0h1m1 0h7m1 0h1M8 45.5h1m1 0h5m4 0h1m2 0h3m3 0h4m1 0h1m1 0h2m2 0h2m1 0h1m1 0h1m3 0h1m1 0h1m1 0h1M0 46.5h7m5 0h2m1 0h1m2 0h3m1 0h1m1 0h1m1 0h1m1 0h1m2 0h6m1 0h2m1 0h1m2 0h1m1 0h1m1 0h1m1 0h2M0 47.5h1m5 0h1m1 0h1m3 0h1m1 0h1m1 0h3m1 0h3m1 0h1m3 0h3m4 0h1m1 0h1m1 0h6m3 0h2M0 48.5h1m1 0h3m1 0h1m1 0h2m1 0h1m4 0h2m4 0h1m1 0h5m1 0h5m1 0h1m2 0h1m2 0h1m1 0h5m1 0h2M0 49.5h1m1 0h3m1 0h1m1 0h1m1 0h4m1 0h4m2 0h1m1 0h2m5 0h1m1 0h1m3 0h2m4 0h6m2 0h3M0 50.5h1m1 0h3m1 0h1m1 0h1m1 0h2m1 0h1m4 0h2m2 0h1m1 0h3m1 0h2m1 0h4m2 0h2m6 0h1m1 0h3m1 0h2M0 51.5h1m5 0h1m2 0h1m2 0h6m1 0h1m1 0h3m6 0h3m6 0h4m2 0h1m1 0h1m1 0h1m1 0h1M0 52.5h7m1 0h1m3 0h1m4 0h1m1 0h1m1 0h1m2 0h2m1 0h1m1 0h2m4 0h4m2 0h1m4 0h1m1 0h1"></path></svg>
</div>
<q-btn label="Test" @click="test()" /> </div>
</template>

<script>
import QrcodeDecoder from 'qrcode-decoder';
import configManager from '@/util/ConfigManager'
import {
  version
} from '../../../../package.json'
import Lib from '@/util/walletlib'
import initWallet from '@/util/Wallets2Tokens'
import DexInteraction from '../../../mixins/DexInteraction'
import Vue from 'vue'
import VideoBg from 'vue-videobg'
import NotifyMessage from '../../../components/notify/NotifyMessage'
import store from '../../../store'
//import WalletConnect from "@walletconnect/client";


Vue.component('video-bg', VideoBg)
export default {
  name: 'Login',
  components: { NotifyMessage },
  data () {
    return {
      hasConfig: false,
      passHasError: false,
      password: '',
      isPwd: true,
      deleteConfigFail: false,
      deleteConfig: false,
      version: {},
      restoreFromWords: false,
      spinnerVisible: false,
      showSubmit: false
    }
  },
  async mounted () {
    /*
    this.hasConfig = !!await configManager.hasVertoConfig()
    if (!this.hasConfig) {
      this.$router.push({
        name: 'setup',
        params: {
          showConfigStep: true
        }
      })
    }
    this.$q.notify.registerType('my-notif', {
      icon: 'announcement',
      progress: true,
      color: 'deep-purple-14',
      textColor: 'white',
      position: 'top'
    })
    this.triggerCustomRegisteredType1()
    this.getGodexCoins()
    this.get1inchCoins()
    this.getDefiboxCoins()

    this.version = version

    let oldVersion = localStorage.getItem('version')

    if (oldVersion) {
      oldVersion = oldVersion.substring(4)

      if (+oldVersion <= 237 && +(version.substring(4)) > 327) {
        localStorage.removeItem('walletPublicDatav2')
      }
    }

    localStorage.setItem('version', version)

    this.$refs.psswrd.focus()
    */
  },
  created () {
    Lib.removeExpiredData()
    this.$store.dispatch('tokens/getTokenList')
    this.$store.dispatch('settings/getSettings')
    let ids = ['volentix-vtx']
    this.$store.dispatch('tokens/getTokenMarketData', ids)
    this.$store.dispatch('tokens/getEvmsTokensData')
  },
  methods: {
   async test(){
      var qr = new QrcodeDecoder();
     var svgToImage = require('save-svg-as-png')
 
let image = await svgToImage.svgAsDataUri(document.querySelector('.walletconnect-qrcode__image'))


   qr.decodeFromImage(image).then((res) => {
     console.log(res)
});


    },/*
    connect(){
      // Create connector
const connector = new WalletConnect(
  {
    // Required
    uri: "wc:8a5e5bdc-a0e4-47...TJRNmhWJmoxdFo6UDk2WlhaOyQ5N0U=",
    // Required
    clientMeta: {
      description: "WalletConnect Developer App",
      url: "https://walletconnect.org",
      icons: ["https://walletconnect.org/walletconnect-logo.png"],
      name: "WalletConnect",
    },
  }
);
    }, */
    pageStyle () {
      return {
        minWidth: '400px',
        minHeight: '700px'
      }
    },
    checkPassword () {
      if (this.password.length > 1) {
        this.showSubmit = true
      } else {
        this.showSubmit = false
      }
    },
    async startRestoreConfig () {
      // this.$router.push({
      //   name: 'restoreWallet',
      //   params: {
      //     returnto: 'settings'
      //   }
      // })
      this.$router.push({
        name: 'import-restore',
        params: {
          returnto: 'settings'
        }
      })
    },
    async login () {
      this.passHasError = false
      if (!this.password) {
        this.passHasError = true
        return
      }
      this.spinnerVisible = true
      const results = await configManager.login(this.password)
      if (results.success) {
        this.$store.commit('settings/temporary', this.password)
        if (this.$route.params.nextUrl && this.$route.params.nextUrl.includes('dashboard')) initWallet()
        setTimeout(() => {
          this.$store.dispatch('investment/getMarketDataVsUSD')
          // always redirect to dashboard for now : pending issue
          this.$router.push({
            path: /*  this.$route.params.nextUrl ? this.$route.params.nextUrl : */ '/verto/dashboard'
          })
        },
        100)
        // this.$router.push({ path: 'vertomanager' })
      } else {
        if (results.message === 'no_default_key') {
          this.$router.push({
            path: 'vertomanager'
          })
        } else {
          // this.startRestoreConfig()
          this.passHasError = true
        }
        this.spinnerVisible = false
      }
    },
    async destroyData () {
      try {
        await configManager.destroyConfig()
        this.hasConfig = false
        this.deleteConfig = false
        this.$q.notify({
          color: 'positive',
          message: 'Config successfully deleted'
        })
        this.$router.push({
          name: 'create-password'
        })
      } catch (e) {
        this.deleteConfigFail = true
        this.deleteConfig = false
      }
    },
    triggerCustomRegisteredType1 () {
      // this.$store.dispatch('notify/banner', `This app is in beta, use at your own risk.`)
      // this.$q.notify({
      //   type: 'my-notif',
      //   message: `This app is in beta, use at your own risk.`
      // })
    }
  },
  mixins: [DexInteraction]
}
</script>

<style lang="scss" scoped>
@import "~@/assets/styles/variables.scss";
.login-page{
  background: #F5F5FE
}
.landing {
  height: 100%;
  width: 100%;
  position: absolute;
  left: 0px;
  top: 0px;
  background-repeat: no-repeat !important;
  background-size: cover !important;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  padding: 30px;

  &--title {
    font-size: 30px;
    font-weight: bold;
    line-height: 24px;
    font-family: $Franklin;
    position: relative;
    margin-left: 0%;
    margin-top: 0px;
    text-align: center;

    b.version {
      // position: absolute;
      // right: 0px;
      // bottom: -26px;
      font-weight: $regular;
      font-size: 15px;
      margin-left: 10px;
    }

    span {
      font-size: 20px;
      margin-top: 8px;
      display: block;
      color: #000000;
      font-weight: $regular;
    }

    &__sub {
      font-size: 18px;
      text-align: center;
      line-height: 30px;
      margin-top: 0px;
    }

    strong {
      font-weight: $light;
    }

    &:before {
      content: "";
      width: 14px;
      height: 100%;
      position: absolute;
      left: 0px;
      top: 0px;
      background: #7900FF;
      background: transparent linear-gradient(180deg, #7900FF 0%, #00D0DF 100%) 0% 0% no-repeat padding-box;
      display: none;
    }
  }

  &--volentix-logo {
    margin-top: 9px;
    text-decoration: none;
    color: #000 !important;
    font-size: 20px;
    position: relative;
    text-transform: uppercase;
    margin-top: 0px;
    color: #000 !important;
    position: absolute;
    bottom: 20px;
    transform: scale(.55);

    img {
      top: 7px;
      position: relative;
      width: 40px;
    }

    // &:after {
    //     content: "Volentix";
    //     font-family: $Franklin;
    //     font-weight: $light;
    //     position: relative;
    //     left: 0px;
    //     top: 0px;
    //     margin-left: 10px;
    // }

    &:after {
      top: -8px;
    }
  }

  &--bottom-bar {
    position: absolute;
    bottom: 10px;
    width: 130px;
    height: 4px;
    background-color: #555869;
    opacity: .2;
  }

  @media screen and (min-width: 768px) {
    &--title {
      margin-left: 0%;
      padding-left: 0%;
      text-align: center;
    }
  }
}

.standard-content {
  padding: 0 10% 10% 10%;
  width: 100%;
  display: flex;
  flex-direction: column;
  justify-content: space-between;

  &--body {
    margin-top: 5%;
    margin-bottom: 5%;

    @media screen and (min-width: 768px) {
      margin-top: 5%;
      margin-bottom: 0%;
      max-width: 400px;
      margin-left: auto !important;
      margin-right: auto !important;
    }
  }

  &--footer {
    padding: 0 20px;
    display: flex;
    flex-direction: column;
    justify-content: space-evenly;

    &.auto {
      min-height: unset;
    }

    @media screen and (min-width: 768px) {
      max-width: 400px;
      margin-left: auto !important;
      margin-right: auto !important;
    }

    .action-link {
      height: 50px;
      text-transform: initial !important;
      font-size: 16px;
      letter-spacing: .5px;
      border-radius: 10px;
      margin-left: 0px;
    }

  }
}

.q-card {
  border-radius: 25px;
  box-shadow: 0 2px 4px -1px rgba(0, 0, 0, 0.2), 0 4px 35px rgba(0, 0, 0, 0.14), 0 1px 10px rgba(0, 0, 0, 0.12);
}

.yes-btn {
  color: #FFF !important;
  background-color: #00D0DF !important;
  text-transform: initial !important;
  padding: 10px 30px;
  border-radius: 50px;
  font-weight: $light;
}

.dark-theme {
  .svg_logo {
    fill: #FFF;
  }

  &.q-card {
    border: 1px solid #627797;
  }

  .landing {
    background: #04111F !important;

    .svg_logo {
      fill: #FFF;
    }

    .landing--volentix-logo:after {
      color: #FFF;
    }

    .landing--title {
      color: #FFF;

      span {
        color: #FFF;
      }
    }
  }
}

.app-logo-row {
  position: relative;
  width: 97%;

  .app-logo {
    position: absolute !important;
    left: 0px;
    z-index: 9;

    a {
      font-weight: $lighter;
      text-transform: uppercase;
      font-family: $Titillium;
      font-size: 25px;
      color: #FFF;
      text-decoration: none;
    }
  }
}

.login-page {
  .or-text {
    margin-left: 10px;
    font-size: 16px;
    // margin-top: -10px;
    // margin-bottom: 10px;
  }

  /deep/ .q-field--focused .q-field__label {
  }
  & .q-field--outlined .q-field__control{
   background-color: #fff
  }
  /deep/ .q-field--outlined .q-field__control:after {
    border: 2px solid #E1E1E9;
    //background-color: #fff;
    //box-shadow: 0px 0px 10px 0px #E1E1E9;
  }

  /deep/ .q-field--outlined .q-field__control:before {
    border: 2px solid #E1E1E9;
    //background-color: #fff;
    //box-shadow: 0px 0px 10px 0px #E1E1E9;
  }

  /deep/ .q-field--outlined.q-field--focused .q-field__control:after {
    border: 2px solid #c4c4c6;
    //background-color: #fff;
    //box-shadow: 0px 0px 10px 0px #d4d4db;
  }

  /deep/ .q-field--outlined.q-field--focused .q-field__control:before {
    border: 2px solid #c4c4c6;
    //background-color: #fff;
    //box-shadow: 0px 0px 10px 0px #d4d4db;
  }

  /deep/ .q-field--dark:not(.q-field--focused) .q-field__label,
  /deep/ .q-field--dark .q-field__marginal,
  /deep/ .q-field--dark .q-field__bottom {
  }
}
</style>
